# Visa 虚拟信用卡生成器：从零到一搭建外币虚拟信用卡

最近，笔者正在推进一个外币虚拟信用卡的项目，即将上线。借此机会，我想对整个项目进行简要总结，并希望与读者分享一些经验。

## 一、项目准备

### 1. 选择卡片类型

在项目初期，我们需要明确卡片的最终使用场景，比如是用于特定行业的商户，还是需要覆盖尽可能多的海外商户。这将帮助我们决定选择预付卡、借记卡还是信用卡。海外商户对信用卡的支持度最高，其次是借记卡，最后是预付卡。由于笔者的项目面向 B 端，覆盖跨境出口电商和海外线上消费，因此选择了企业借记卡。

### 2. 选择发卡通道

确定使用场景后，我们需要选择接入的卡组织，通常是 Visa 或 Mastercard。实力强大的公司可以直接与 Visa、Mastercard 对接发卡，而更多企业则通过对接发卡通道来完成发卡。笔者的项目选择了一家非银行的发卡机构。

### 3. 选择持卡人账户模型

发卡通道通常提供两种持卡人账户模型：鉴权模式和懒人模式。两种模式下，通道都会提供一个资金池账户。鉴权模式的机制是：交易发生时，发卡通道会先询问我们是否要继续完成交易，当我们确认后，通道会实时扣除资金池账户中的相应金额；而懒人模式的机制是，发卡通道会记录持卡人卡内余额，交易会直接从卡内余额扣除，交易完成前我们无法获知交易详情。

鉴权模式的优势在于灵活性和可扩展性更强，而懒人模式则简化了资金管理流程。笔者的项目采用了懒人模式。

## 二、项目建设

完成初期准备工作后，进入实际建设阶段。笔者将一期建设规划为以下几个功能模块：

### 1. 查看卡片详情

包括卡片余额、完整卡号、CVV、有效期及交易明细。这些信息可以直接从发卡通道的接口中获取。为了提高用户体验，笔者采用了主动和被动更新的缓存机制。例如，当用户的个人账户有充值到账时，系统会接收到 Webhook 并更新缓存；同时，系统也会每隔几分钟主动更新缓存。

### 2. 卡片充值

由于笔者的项目是外币卡项目，充值必须以外币资产进行。最初，用户的充值方案是转账到公司海外母公司的对公账户，然后手动转入资金池账户，最后通过接口充值到用户的卡账户。这种方案成本高且流程繁琐，因此在上线前，笔者寻找了更合理的充值方案。

### 3. 卡内余额转出

在与发卡通道沟通过程中，突然发现不支持卡片余额转出，因此该功能被暂时搁置。

### 4. 虚拟信用卡申请

根据发卡通道的资料需求，结合业务场景，笔者设计了卡申请流程。

### 5. 充值方案优化

在开发卡申请功能时，笔者优化了充值方案。通过对接一款收款产品，充值流程变得更加高效。收款产品无需发起收款请求，而是直接将收款账户呈现给用户，并为每个 B 端用户提供唯一的数字码以区分资金来源。

在此基础上，笔者引入了用户钱包账户的概念。用户账户的余额来自所有转账到收款账户的金额，用户可以选择将特定金额充值到卡账户。为了提升用户体验，笔者在资金池账户中存放了一部分备付金，先垫付用户充值，然后通过 SWIFT 转账将收款账户余额转入资金池账户。

### 6. 钱包账户

引入钱包账户后，用户还可以查询钱包余额和交易明细。这些信息由系统单独维护，因此没有接口响应慢的问题。

### 7. 对账

对账主要涉及两部分：资金池账户的对账和持卡人交易的对账。笔者将收款账户的转出交易放入待匹配交易库，与资金池账户的转入交易匹配后更新交易状态。

## 三、项目后续

虚拟信用卡的一期搭建已接近尾声。后续项目将实现以下功能，以更好地服务客户：

### 1. 收款账户优化

为每个 B 端客户提供独立的海外当地收款账户，便于接收电商平台（如 Amazon）和收单渠道（如 PayPal）的款项。款项到账后，相应金额将增加至用户的钱包账户。

### 2. 换汇

提供用户钱包账户资产换汇的功能。

### 3. 钱包账户转出

通过钱包账户实现资产转出功能，避免用户因只能充值到卡账户而产生抵触情绪。

👉 [WildCard | 一分钟注册，轻松订阅海外线上服务](https://bbtdd.com/WildCard)